<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cadastrar Agente - Agentes Vigilância</title>
  <style>
    :root {
      --verde: #90a224;
      --vermelho: #801815;
      --amarelo: #FDC75F;
      --preto: #000000;
      --fonte-principal: Arial, sans-serif;
    }

    .faixa {
     width: 100%;
     height: 10px;
     background: linear-gradient(to right, #447D37 0%, #447D37 33%, #801815 33%, #801815 66%, #ECC700 66%, #ECC700 100%);
     }

    body {
      margin: 0;
      padding: 0;
      font-family: var(--fonte-principal);
      background-color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      min-height: 210vh;
    }

    .container {
      background-color: #fff;
      border: 5px solid var(--verde);
      border-radius: 16px;
      padding: 60px;
      max-width: 800px;
      width: 100%;
      box-shadow: 0 8px 16px rgba(0,0,0,0.5);
      text-align: center;
    }

    h1 {
      color: var(--vermelho);
      font-size: 28px;
      margin-bottom: 30px;
    }

    label {
      display: block;
      text-align: left;
      font-weight: bold;
      color: var(--preto);
      margin-bottom: 10px;
    }

    input {
      width: 100%;
      padding: 10px;
      margin-bottom: 20px;
      border: 2px solid var(--verde);
      border-radius: 8px;
      font-size: 16px;
    }

    button {
      background-color: var(--verde);
      color: #fff;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin: 10px 5px;
    }

    select {
      width: 100%;
      padding: 10px;
      margin-bottom: 20px;
      border: 2px solid var(--verde);
      border-radius: 8px;
      font-size: 16px;
    }

    button:hover {
      background-color: #73811d;
    }

    #msg {
      margin-top: 15px;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <div class="faixa">
  </div>

  <div class="container">

    <h1>Agente de Vigilância Sanitária</h1>

    <label for="cpf">CPF:</label>
    <input type="text" id="cpf" placeholder="000.000.000-00" />

    <label for="cns">CNS CNES:</label>
    <input type="text" id="cns" />

    <label for="data_nascimento">Data de nascimento:</label>
    <input type="date" id="data_nascimento" />

    <label for="municipio">Município:</label>
    <input type="text" id="municipio" />

    <label for="especialidade">Especialidade:</label>
    <select id="especialidade">
      <option value="">-- Selecione --</option>
    </select>

    <label for="nivel_escolaridade">Nível Escolaridade:</label>
    <select id="nivel_escolaridade">
      <option value="">-- Selecione --</option>
    </select>

    <label for="capacitacao">Capacitação:</label>
    <select id="capacitacao">
      <option value="">-- Selecione --</option>
    </select>

    <label for="cbo_cnes">CBO CNES:</label>
    <select id="cbo_cnes">
      <option value="">-- Selecione --</option>
    </select>

    <label for="vinculo">Vínculo Empregatício:</label>
    <select id="vinculo">
      <option value="">-- Selecione --</option>
    </select>

    <label for="cargo">Cargo:</label>
    <select id="cargo">
      <option value="">-- Selecione --</option>
    </select>

    <label for="genero">Gênero:</label>
    <select id="genero">
      <option value="">-- Selecione --</option>
    </select>

    <label for="unidade">Unidade Vigilância Sanitária:</label>
    <select id="unidade">
      <option value="">-- Selecione --</option>
    </select>

    <button id="btnEnviarFormulario">Enviar Dados</button>

    <div id="status"></div>

    <script>
      const BASE_URL = "http://localhost:8000";

      async function carregarOpcoes(url, seletor) {
        try {
          const resposta = await fetch(url);
          const opcoes = await resposta.json();

          const select = document.querySelector(seletor);
          opcoes.forEach(opcao => {
            const option = document.createElement("option");
            option.value = opcao.codigo;
            option.textContent = opcao.descricao;
            select.appendChild(option);
          });
        } catch (erro) {
          console.error(`Erro ao carregar ${seletor}:`, erro);
        }
      }

      const campos = {
        "#especialidade": `${BASE_URL}/opcoes/especialidades`,
        "#nivel_escolaridade": `${BASE_URL}/opcoes/nivel_escolaridade`,
        "#capacitacao": `${BASE_URL}/opcoes/capacitacoes`,
        "#cbo_cnes": `${BASE_URL}/opcoes/cbo_cnes`,
        "#vinculo": `${BASE_URL}/opcoes/vinculos`,
        "#cargo": `${BASE_URL}/opcoes/cargos`,
        "#genero": `${BASE_URL}/opcoes/generos`,
        "#unidade": `${BASE_URL}/opcoes/unidades_vigilancia`
      };

      document.addEventListener("DOMContentLoaded", () => {
        for (const [seletor, url] of Object.entries(campos)) {
          carregarOpcoes(url, seletor);
        }
      });

      async function enviarFormulario() {
        const dados = {
          nu_cpf: document.querySelector("#cpf").value,
          nu_cns_cnes: document.querySelector("#cns").value,
          data_nascimento: document.querySelector("#data_nascimento").value,
          municipio: document.querySelector("#municipio").value,

          co_especialidade: parseInt(document.querySelector("#especialidade").value),
          co_nivel_escolaridade: parseInt(document.querySelector("#nivel_escolaridade").value),
          co_capacitacao: parseInt(document.querySelector("#capacitacao").value),
          co_cbo_cnes: parseInt(document.querySelector("#cbo_cnes").value),
          ds_vinculo_empregaticio: parseInt(document.querySelector("#vinculo").value),
          ds_cargo: parseInt(document.querySelector("#cargo").value),
          co_genero: parseInt(document.querySelector("#genero").value),
          co_unidade_vigilancia_sanitaria: parseInt(document.querySelector("#unidade").value)
        };

        try {
          const token = localStorage.getItem("token");
          if (!token) {
            alert("Você precisa fazer login antes de enviar o formulário.");
            return;
          }

          const resposta = await fetch(`${BASE_URL}/agentes`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "Authorization": `Bearer ${token}`
            },
            body: JSON.stringify(dados)
          });

          if (!resposta.ok) {
            const erro = await resposta.json();
            alert("Erro ao enviar: " + erro.detail);
          } else {
            const resultado = await resposta.json();
            document.getElementById("status").textContent = "Agente cadastrado com sucesso!";
            console.log(resultado);
          }
        } catch (erro) {
          console.error("Erro ao enviar dados:", erro);
          alert("Erro de conexão com o servidor");
        }
      }

      document.getElementById("btnEnviarFormulario").addEventListener("click", () => {
        enviarFormulario();
      });
    </script>
  </div>

  <div class="faixa">
  </div>
  
</body>
</html>
